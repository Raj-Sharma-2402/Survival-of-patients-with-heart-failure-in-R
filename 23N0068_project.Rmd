---
title: "Survival of patients with heart failure"
author: "Raj Sharma"
date: "2023-11-11"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---
**Source of data:**
UCI machine learning repository:https://archive.ics.uci.edu/dataset/519/heart+failure+clinical+records

**Upload date of data:** 2nd April 2020

**Owner of the data:** 
The original dataset version was collected by Tanvir Ahmad, Assia Munir, Sajjad Haider Bhatti, Muhammad Aftab, and Muhammad Ali Raza in 2015.
Current dataset has slight difference from original dataset in terms of names of columns which was done by D. Chicco and Giuseppe Jurman in their article published on BMC Medical Informatics and Decision Making.
Link:https://bmcmedinformdecismak.biomedcentral.com/articles/10.1186/s12911-020-1023-5#article-info

**Objective of data collection:**
Dataset was collected for analyzing the survival pattern of heart failure patients who were admitted to Institute of Cardiology and Allied hospital Faisalabad-Pakistan during April-December (2015).
And also rank the features which corresponds to the most important risk factors.

**Analysis of data by other researchers:**
D.Chicco and Giuseppe Jurman found in their analysis that serum creatinine and ejection fraction plays a very important role in understanding if a patient will survive after heart failure or not.This discovery has the potential to impact on clinical practice, becoming a new supporting tool for physicians when predicting if a heart failure patient will survive or not.

**Description of data set:**
This dataset was collected during Aprilâ€“December 2015.It contains the medical records of 299 heart failure patients collected at the Faisalabad Institute of Cardiology and at the Allied Hospital in Faisalabad (Punjab, Pakistan). The patients consisted of 105 women and 194 men, and their ages range between 40 and 95 years old. All 299 patients had left ventricular systolic dysfunction and had previous heart failures that put them in classes III or IV of New York Heart Association (NYHA) classification of the stages of heart failure. 
The dataset contains 13 features, which report clinical, body, and lifestyle information.

**Description of columns:**
```{r}
column_des<-read.csv("C:/Users/rajsh/OneDrive/Documents/Rproject/Book1.csv")
print(column_des)
```
The hospital physician considered a patient having **anaemia** if haematocrit levels were lower than 36%.<br>
The **creatinine phosphokinase (CPK)** states the level of the CPK enzyme in blood. When a muscle tissue gets damaged, CPK flows into the blood. Therefore, high levels of CPK in the blood of a patient might indicate a heart failure or injury.It is measured in microgram per litre (mcg/L).<br>
The **ejection fraction** states the percentage of how much blood the left ventricle pumps out with each contraction.<br>
The **serum creatinine** is a waste product generated by creatine, when a muscle breaks down.Doctors focus on serum creatinine in blood to check kidney function. If a patient has high levels of serum creatinine, it may indicate renal dysfunction.A normal range for serum creatinine is approximately 0.6 to 1.3 milligrams per deciliter (mg/dL) for adult males and 0.5 to 1.2 mg/dL for adult females.<br>
The **serum sodium test** is a routine blood exam that indicates if a patient has normal levels of sodium in the blood. An abnormally low level of sodium(<125 mEq/L) in the blood might be caused by heart failure.mEq/L represents milliequivalents per liter.<br>
The **death event** feature, that we use as the target in our binary classification study, states if the patient died or survived before the end of the follow-up period, that was 130 days on average.<br>

**Purpose of my project:**Carrying out EDA to look for important factors for predicting survival of patients from heart failure.
------------------------------------------------------------------------------------------------------------
```{r}
#loading necessary libraries
library(ggplot2)
library(dplyr)
library(moments)
```

```{r}
#Loading dataset 
df<-read.csv("C:/Users/rajsh/OneDrive/Documents/Rproject/heart_failure_clinical_records_dataset.csv")
head(df)
```
```{r}
#Structure of data
cat("Shape of the dataset is:",dim(df),"\n")
str(df)
```
Since age is measured in years and platelets are count so they are integer columns, thus converting them into integer.
By description of dataset we know that anaemia,high blood pressure,diabetes,sex and smoking are categorical columns which are encoded with 0 and 1.
```{r}
df$age <- as.integer(df$age)
str(df)
```
```{r}
#Getting basic descriptive statistic summary of categorical columns
#For Anaemia
Anaemia_df <- data.frame(
  Anaemia = c("Present", "Absent"),
  Full_sampleNumber = c(sum(df$anaemia), 299 - sum(df$anaemia)),
  Full_samplePercentage = c(sum(df$anaemia) * 100 / nrow(df), (299 - sum(df$anaemia)) * 100 / nrow(df)),
  Dead_patientsNumber = c(sum(df[df$DEATH_EVENT == 1, ]$anaemia),sum(df$DEATH_EVENT)-sum(df[df$DEATH_EVENT == 1, ]$anaemia)),
  Dead_patientsPercentage = c(sum(df[df$DEATH_EVENT == 1, ]$anaemia) * 100 /sum(df$DEATH_EVENT), (sum(df$DEATH_EVENT)- sum(df[df$DEATH_EVENT == 1, ]$anaemia)) * 100 /sum(df$DEATH_EVENT)) ,
  Survived_patientsNumber = c(sum(df[df$DEATH_EVENT == 0, ]$anaemia), ((299-sum(df$DEATH_EVENT)) - sum(df[df$DEATH_EVENT == 0, ]$anaemia))),
  Survived_patientsPercentage = c(sum(df[df$DEATH_EVENT == 0, ]$anaemia) * 100 /(299-sum(df$DEATH_EVENT)) , ((299-sum(df$DEATH_EVENT)) - sum(df[df$DEATH_EVENT == 0, ]$anaemia)) * 100 / (299-sum(df$DEATH_EVENT)))
)
print(Anaemia_df)

#For High blood pressure
High_blood_pressure_df <- data.frame(
  High_blood_pressure = c("Present", "Absent"),
  Full_sampleNumber = c(sum(df$high_blood_pressure), 299 - sum(df$high_blood_pressure)),
  Full_samplePercentage = c(sum(df$high_blood_pressure) * 100 / nrow(df), (299 - sum(df$high_blood_pressure)) * 100 / nrow(df)),
  Dead_patientsNumber = c(sum(df[df$DEATH_EVENT == 1, ]$high_blood_pressure), sum(df$DEATH_EVENT) - sum(df[df$DEATH_EVENT == 1, ]$high_blood_pressure)),
  Dead_patientsPercentage = c(sum(df[df$DEATH_EVENT == 1, ]$high_blood_pressure) * 100 / sum(df$DEATH_EVENT), (sum(df$DEATH_EVENT) - sum(df[df$DEATH_EVENT == 1, ]$high_blood_pressure)) * 100 / sum(df$DEATH_EVENT)),
  Survived_patientsNumber = c(sum(df[df$DEATH_EVENT == 0, ]$high_blood_pressure), (299 - sum(df$DEATH_EVENT)) - sum(df[df$DEATH_EVENT == 0, ]$high_blood_pressure)),
  Survived_patientsPercentage = c(sum(df[df$DEATH_EVENT == 0, ]$high_blood_pressure) * 100 / (299 - sum(df$DEATH_EVENT)), ((299 - sum(df$DEATH_EVENT)) - sum(df[df$DEATH_EVENT == 0, ]$high_blood_pressure)) * 100 / (299 - sum(df$DEATH_EVENT)))
)
print(High_blood_pressure_df)

# For Diabetes
Diabetes_df <- data.frame(
  Diabetes = c("Present", "Absent"),
  Full_sampleNumber = c(sum(df$diabetes), 299 - sum(df$diabetes)),
  Full_samplePercentage = c(sum(df$diabetes) * 100 / nrow(df), (299 - sum(df$diabetes)) * 100 / nrow(df)),
  Dead_patientsNumber = c(sum(df[df$DEATH_EVENT == 1, ]$diabetes), sum(df$DEATH_EVENT) - sum(df[df$DEATH_EVENT == 1, ]$diabetes)),
  Dead_patientsPercentage = c(sum(df[df$DEATH_EVENT == 1, ]$diabetes) * 100 / sum(df$DEATH_EVENT), (sum(df$DEATH_EVENT) - sum(df[df$DEATH_EVENT == 1, ]$diabetes)) * 100 / sum(df$DEATH_EVENT)),
  Survived_patientsNumber = c(sum(df[df$DEATH_EVENT == 0, ]$diabetes), ((299 - sum(df$DEATH_EVENT)) - sum(df[df$DEATH_EVENT == 0, ]$diabetes))),
  Survived_patientsPercentage = c(sum(df[df$DEATH_EVENT == 0, ]$diabetes) * 100 / (299 - sum(df$DEATH_EVENT)), ((299 - sum(df$DEATH_EVENT)) - sum(df[df$DEATH_EVENT == 0, ]$diabetes)) * 100 / (299 - sum(df$DEATH_EVENT)))
)
print(Diabetes_df)

# For Sex 
Sex_df <- data.frame(
  Sex = c("Man", "Female"),
  Full_sampleNumber = c(sum(df$sex), 299 - sum(df$sex)),
  Full_samplePercentage = c(sum(df$sex) * 100 / nrow(df), (299 - sum(df$sex)) * 100 / nrow(df)),
  Dead_patientsNumber = c(sum(df[df$DEATH_EVENT == 1, ]$sex), sum(df$DEATH_EVENT) - sum(df[df$DEATH_EVENT == 1, ]$sex)),
  Dead_patientsPercentage = c(sum(df[df$DEATH_EVENT == 1, ]$sex) * 100 / sum(df$DEATH_EVENT), (sum(df$DEATH_EVENT) - sum(df[df$DEATH_EVENT == 1, ]$sex)) * 100 / sum(df$DEATH_EVENT)),
  Survived_patientsNumber = c(sum(df[df$DEATH_EVENT == 0, ]$sex), ((299 - sum(df$DEATH_EVENT)) - sum(df[df$DEATH_EVENT == 0, ]$sex))),
  Survived_patientsPercentage = c(sum(df[df$DEATH_EVENT == 0, ]$sex) * 100 / (299 - sum(df$DEATH_EVENT)), ((299 - sum(df$DEATH_EVENT)) - sum(df[df$DEATH_EVENT == 0, ]$sex)) * 100 / (299 - sum(df$DEATH_EVENT)))
)
print(Sex_df)

# For Smoking
Smoking_df <- data.frame(
  Smoking = c("Present", "Absent"),
  Full_sampleNumber = c(sum(df$smoking), 299 - sum(df$smoking)),
  Full_samplePercentage = c(sum(df$smoking) * 100 / nrow(df), (299 - sum(df$smoking)) * 100 / nrow(df)),
  Dead_patientsNumber = c(sum(df[df$DEATH_EVENT == 1, ]$smoking), sum(df$DEATH_EVENT) - sum(df[df$DEATH_EVENT == 1, ]$smoking)),
  Dead_patientsPercentage = c(sum(df[df$DEATH_EVENT == 1, ]$smoking) * 100 / sum(df$DEATH_EVENT), (sum(df$DEATH_EVENT) - sum(df[df$DEATH_EVENT == 1, ]$smoking)) * 100 / sum(df$DEATH_EVENT)),
  Survived_patientsNumber = c(sum(df[df$DEATH_EVENT == 0, ]$smoking), ((299 - sum(df$DEATH_EVENT)) - sum(df[df$DEATH_EVENT == 0, ]$smoking))),
  Survived_patientsPercentage = c(sum(df[df$DEATH_EVENT == 0, ]$smoking) * 100 / (299 - sum(df$DEATH_EVENT)), ((299 - sum(df$DEATH_EVENT)) - sum(df[df$DEATH_EVENT == 0, ]$smoking)) * 100 / (299 - sum(df$DEATH_EVENT)))
)
print(Smoking_df)
```
**We can clearly observe that:**<br>
1) Out of 299 patients 129 were found to have anaemia which is about 43% of total population. Only 64.34% patient who had anaemia could survive till follow-up period.<br>
2) Out of 299 patients 105 were found to have high blood pressure which is about 35% of total population. Only 62.85% patient who had high blood pressure could survive till follow-up period.<br>
3) Out of 299 patients 125 were found to have diabetes which is about 42% of total population. Only 68% patient who had diabetes could survive till follow-up period.<br>
4) Male constituted 64.88% and Female constituted 35.12% of total population.<br>
5) Out of 299 patients 96 were found to have diabetes which is about 32% of total population. Only 68.75% patient who had diabetes could survive till follow-up period.<br>

**Univariate analysis**
```{r}
#Getting basic descriptive statistic summary of age column
cat("For age","\n")
summary(df$age)
cat("Standard deviation:",sd(df$age),"\n")
cat("Skewness:",skewness(df$age),"\n")
cat("Kurtosis:",kurtosis(df$age),"\n","\n")

#For age
par(mfrow=c(1,2))
hist(df$age,main="Age",xlab="age")
boxplot(df$age,main="Age")
par(mfrow=c(1,1))
```
Age of patients lie between range 40-95 years with average age of 60.83 years and standard deviation of 11.895.<br>
Most of the patients have age 55-65 years.<br>
```{r}
#Getting basic descriptive statistic summary of Creatinine phosphokinase
cat("For creatinine_phosphokinase","\n")
summary(df$creatinine_phosphokinase)
cat("Standard deviation:",sd(df$creatinine_phosphokinase),"\n")
cat("Skewness:",skewness(df$creatinine_phosphokinase),"\n")
cat("Kurtosis:",kurtosis(df$creatinine_phosphokinase),"\n","\n")

#For Creatinine phosphokinase
par(mfrow=c(1,2))
hist(df$creatinine_phosphokinase,main="Creatinine phosphokinase",xlab="creatinine_phosphokinase")
boxplot(df$creatinine_phosphokinase,main="Creatinine phosphokinase")
par(mfrow=c(1,1))
```
Creatinine phosphokinase column is highly right skewed & peaked with range of 23-7861,standard deviation of 970.28, Skewness of 4.44 ,kurtosis of 27.7.<br>
From the box-plot we can see that it has many outliers.<br>
```{r}
#Getting basic descriptive statistic summary of Ejection fraction
cat("For ejection_fraction","\n")
summary(df$ejection_fraction)
cat("Standard deviation:",sd(df$ejection_fraction),"\n")
cat("Skewness:",skewness(df$ejection_fraction),"\n")
cat("Kurtosis:",kurtosis(df$ejection_fraction),"\n","\n")

#For Ejection fraction
par(mfrow=c(1,2))
hist(df$ejection_fraction, main="Ejection Fraction", xlab="Ejection Fraction")
boxplot(df$ejection_fraction, main="Ejection Fraction")
par(mfrow=c(1,1))
```
Ejection fraction column has range of 14-80 ,mean of 38.08 ,standard deviation of 11.83, Skewness of 0.55 ,kurtosis of 3.02.<br>
```{r}
#Getting basic descriptive statistic summary of Platelets
cat("For plateles","\n")
summary(df$platelets)
cat("Standard deviation:",sd(df$platelets),"\n")
cat("Skewness:",skewness(df$platelets),"\n")
cat("Kurtosis:",kurtosis(df$platelets),"\n","\n")

#For Platelets 
par(mfrow=c(1,2))
hist(df$platelets, main="Platelets", xlab="Platelets")
boxplot(df$platelets, main="Platelets")
par(mfrow=c(1,1))

```
Platelets column is high peaked column with range of 25100-850000,mean of 263358 ,standard deviation of 97804.24, Skewness of 1.45 ,kurtosis of 9.08.<br>
From the box-plot we can see that it has many outliers.<br>
```{r}
#Getting basic descriptive statistic summary of Serum creatinine 
cat("For serum_creatinine","\n")
summary(df$serum_creatinine)
cat("Standard deviation:",sd(df$serum_creatinine),"\n")
cat("Skewness:",skewness(df$serum_creatinine),"\n")
cat("Kurtosis:",kurtosis(df$serum_creatinine),"\n","\n")

#For Serum creatinine 
par(mfrow=c(1,2))
hist(df$serum_creatinine, main="Serum Creatinine", xlab="Serum Creatinine")
boxplot(df$serum_creatinine, main="Serum Creatinine")
par(mfrow=c(1,1))

```
Serum creatinine is highly right skewed & peaked with range of 0.5-9.4, standard deviation of 1.03,Skewness of 4.43 ,kurtosis of 28.37.<br>
From the box-plot we can see that it has many outliers.<br>
```{r}
#Getting basic descriptive statistic summary of Serum sodium
cat("For serum_sodium","\n")
summary(df$serum_sodium)
cat("Standard deviation:",sd(df$serum_sodium),"\n")
cat("Skewness:",skewness(df$serum_sodium),"\n")
cat("Kurtosis:",kurtosis(df$serum_sodium),"\n","\n")

#For Serum sodium
par(mfrow=c(1,2))
hist(df$serum_sodium, main="Serum Sodium", xlab="Serum Sodium")
boxplot(df$serum_sodium, main="Serum Sodium")
par(mfrow=c(1,1))

```
Serum sodium has range of 113-148, mean of 136.6, standard deviation of 4.41,Skewness of -1.04,kurtosis of 7.03.<br>
It is left skewed.<br>
```{r}
#Getting basic descriptive statistic summary of Death event
cat("For time","\n")
summary(df$time)
cat("Standard deviation:",sd(df$time),"\n")
cat("Skewness:",skewness(df$time),"\n")
cat("Kurtosis:",kurtosis(df$time),"\n")
hist(df$time)

#For Death event
ggplot(df, aes(x =  DEATH_EVENT)) +geom_bar(fill = "lightblue") +labs(title = " DEATH EVENT", x = " DEATH_EVENT", y = "Frequency")
pie(table(df$ DEATH_EVENT), labels = paste0(names(table(df$ DEATH_EVENT)), ": ", round(table(df$ DEATH_EVENT)/sum(table(df$ DEATH_EVENT)) * 100, 2), "%"),main = " DEATH_EVENT Distribution", col = c("red", "lightgreen"))

```
Among 299 patients 67.89% died before follow-up period.<br>

**Bivariate analysis**
```{r}
#Death vs Age
boxplot(df$age ~ df$DEATH_EVENT, main = "Death vs Age", xlab = "DEATH_EVENT", ylab = "Age")
```
From death vs age plot we see that young age group people have more chances of survival.<br>
```{r}
#Death vs Creatinine phosphokinase
boxplot(df$creatinine_phosphokinase ~ df$DEATH_EVENT, main = "Death vs Creatinine phosphokinase", xlab = "DEATH_EVENT", ylab = "Creatinine phosphokinase")

df_summary <- df %>%
  group_by(DEATH_EVENT) %>%
  summarize(mean_cpk = mean(creatinine_phosphokinase))

# Draw a line plot with the summary data
plot(df_summary$DEATH_EVENT, df_summary$mean_cpk, type = "l",
     xlab = "Death Event", ylab = "Mean Creatinine Phosphokinase",col="red",lty=2)
```
From the line plot we can see that on an average the patients who died had high value of CPK.We might consider it as potential factor to predict survival of patients.But since the range of CPK was too high than its mean so we cannot say with high certainty that it is a good factor to predict survival.<br>
```{r}
#Death vs Ejection fraction
boxplot(df$ejection_fraction ~ df$DEATH_EVENT, main = "Death vs Ejection fraction", xlab = "DEATH_EVENT", ylab = "Ejection fraction")
```
Ejection fraction vs death plot reveals that the people who died had low value of ejection fraction i.e. left ventricle does not pumps effectively with each contraction.<br>
```{r}
#Death vs Platelets
boxplot(df$platelets ~ df$DEATH_EVENT, main = "Death vs Platelets", xlab = "DEATH_EVENT", ylab = "Platelets")

df_summary <- df %>%
  group_by(DEATH_EVENT) %>%
  summarize(mean_plat = mean(platelets))

# Draw a line plot with the summary data
plot(df_summary$DEATH_EVENT, df_summary$mean_plat, type = "l",
     xlab = "Death Event", ylab = "Mean Platelets",col="red",lty=2)
```
On Average plateletes count remained same for patients who survived and who died. Since there is very slight cange in average of platelets count.<br>
```{r}
#Death vs Serum creatinine
boxplot(df$serum_creatinine ~ df$DEATH_EVENT, main = "Death vs Serum creatinine", xlab = "DEATH_EVENT", ylab = "Serum creatinine")
```
High value for Serum creatinine was observed for patients who died telling that it can be potential factor for predicting survival of patients.<br>
```{r}
#Death vs Serum sodium
boxplot(df$serum_sodium ~ df$DEATH_EVENT, main = "Death vs Serum sodium", xlab = "DEATH_EVENT", ylab = "Serum sodium")
```
Low value for Serum sodium was observed for patients who died telling that it can be potential factor for predicting survival of patients.<br>

#Analysis of survival and sex of patients taken together
```{r}
#Death&Sex vs Age
boxplot(df$age ~ interaction(df$DEATH_EVENT,df$sex), main = "Death&Sex vs Age", xlab = "DEATH_EVENT & SEX", ylab = "Age",names=c("Survived_Female","Death_Female","Survived_male","Death_male"))
```
Among all patients male patients who were younger had high chances of survival since among those males who died older ones were majority.And same is observed for females.<br>
```{r}
#Death&Sex vs Serum Creatinine
boxplot(df$serum_creatinine ~ interaction(df$DEATH_EVENT,df$sex), main = "Death&Sex vs Serum Creatinine", xlab = "DEATH_EVENT & SEX", ylab = "Serum Creatinine",names=c("Survived_Female","Death_Female","Survived_male","Death_male"))
```
In both males and females the patients who had high level of Serum Creatinine died before follow up period.<br>
#Relationship between different feature columns
```{r}
#Anaemia vs Age
boxplot(df$age ~ df$anaemia, main = "Anaemia vs Age", xlab = "Anaemia", ylab = "Age")
legend("topright", legend = c("Absent = 0", "Present = 1"),cex=0.8)

```
On average age remained same for patients who had anaemia and who didn't have anaemia.
```{r}
#Diabetes vs Age
boxplot(df$age ~ df$diabetes, main = "Diabetes vs Age", xlab = "Diabetes", ylab = "Age")
legend("topright", legend = c("Absent = 0", "Present = 1"),cex=0.8)

```
On average age remained same for patients who had diabetes and who didn't have diabetes.
```{r}
#High blood pressure vs Age
boxplot(df$age ~ df$high_blood_pressure, main = "High blood pressures vs Age", xlab = "High blood pressure", ylab = "Age")
legend("topright", legend = c("Absent = 0", "Present = 1"),cex=0.8)

```
Patients who had high blood pressure were slightly aged than those who didn't had high blood pressure.<br>
```{r}
#Anaemia & Sex
df_males <- subset(df, sex == 1)
df_females <- subset(df, sex == 0)

# Create a table for anaemia and sex
x <- table(df_males$anaemia, df_males$sex)
y <- table(df_females$anaemia, df_females$sex)
x_percentage <- prop.table(x, margin = 2) * 100
y_percentage <- prop.table(y, margin = 2) * 100  # Calculate percentages across columns (sex)

par(mfrow=c(1,2))
# Barplot for males with percentages
barplot(x_percentage, beside = TRUE, col = c("lightgreen", "red"), 
        legend = rownames(y_percentage), main = "Anaemia in males",
        xlab = "Anaemia Status", ylab = "Percentage")
# Barplot for females with percentages
barplot(y_percentage, beside = TRUE, col = c("lightgreen", "red"), 
        legend = rownames(y_percentage), main = "Anaemia in Females",
        xlab = "Anaemia Status", ylab = "Percentage")

```
Among male patients around 40% had anaemia and among female around 50% had anaemia.That may mean that females are more prone to anaemia.<br>
```{r}
df_males <- subset(df, sex == 1)
df_females <- subset(df, sex == 0)

# Create a table for diabetes and sex
x <- table(df_males$diabetes, df_males$sex)
y <- table(df_females$diabetes, df_females$sex)
x_percentage <- prop.table(x, margin = 2) * 100
y_percentage <- prop.table(y, margin = 2) * 100  # Calculate percentages across columns (sex)

par(mfrow=c(1,2))
# Barplot for males with percentages
barplot(x_percentage, beside = TRUE, col = c("lightgreen", "red"), 
        legend = rownames(y_percentage), main = "Diabetes in Males",
        xlab = "Diabetes Status", ylab = "Percentage")
# Barplot for females with percentages
barplot(y_percentage, beside = TRUE, col = c("lightgreen", "red"), 
        legend = rownames(y_percentage), main = "Diabetes in Females",
        xlab = "Diabetes Status", ylab = "Percentage")

```
Among male patients around 35% had diabetes and among female around 52% had diabetes.That may mean that females are more prone to diabetes.<br>
```{r}
#Smoking vs Ejection fraction
boxplot(df$ejection_fraction ~ df$smoking, main = "Smoking vs Ejection fraction", xlab = "Smoking", ylab = "Ejection fraction")
legend("topright", legend = c("Non smoker = 0", "Smoker = 1"),cex=0.8)
```
Smoker patients had low value of ejection fraction, meaning that smoking may cause decrease in the pumping capacity of heart.<br>
```{r}
#Creatinine phosphokinase vs Ejection fraction
plot(x=df$creatinine_phosphokinase,y=df$ejection_fraction,main="Creatinine phosphokinase vs Ejection fraction",xlab="Creatinine phosphokinase",ylab="Ejection fraction",type="p")
abline(lm(df$ejection_fraction~df$creatinine_phosphokinase),col="red")
```
We can see from the graph that as the CPK level increases ejection fraction decreases representing that blood pumping capacity of heart decrease whenever heart injury occurs.
```{r}
#Creatinine phosphokinase vs Serum Creatinine
plot(x=df$creatinine_phosphokinase,y=df$serum_creatinine,main="Creatinine phosphokinase vs Serum Creatinine",xlab="Creatinine phosphokinase",ylab="Serum Creatinine")
abline(lm(df$serum_creatinine~df$creatinine_phosphokinase),col="red")
```
```{r}
#Creatinine phosphokinase vs Serum sodium
plot(x=df$creatinine_phosphokinase,y=df$serum_sodium,main="Creatinine phosphokinase vs Serum sodium",xlab="Creatinine phosphokinase",ylab="Serum sodium")
abline(lm(df$serum_sodium~df$creatinine_phosphokinase),col="red")
```
```{r}
#Creatinine phosphokinase vs Platelets
plot(x=df$creatinine_phosphokinase,y=df$platelets,main="Creatinine phosphokinase vs Platelets",xlab="Creatinine phosphokinase",ylab="Platelets")
abline(lm(df$platelets~df$creatinine_phosphokinase),col="red")
```

**Key findings:**<br>
1)Ejection fraction, Serum sodium and Serum creatinine can be considered as important factors to predict survival of patients.
2)Females are more prone to anaemia and diabetes than males.
3)Smoking can cause decrease in pumping capacity of heart.
4)Presence of CPK enzyme may be considered for detection of heart injury.


**Splitting Dataset into training and testing data**
```{r}
train_indices <- sample(1:nrow(df), 0.75 * nrow(df),replace = F)
train_data <- df[train_indices, ]
test_data <- df[-train_indices, ]
train_data
test_data
```
**Model development (logistic) **
```{r}
logistic_model = glm(DEATH_EVENT~., data=train_data, family="binomial")
summary(logistic_model)
```

**Applying this model to test data**
```{r}
pred_prob <- predict(logistic_model, newdata = test_data, type = "response")
#Setting threshold probability to 0.5
threshold <- 0.5
test_predictions <- ifelse(pred_prob > threshold, 1, 0)
test_predictions
```
**Model evaluation **
```{r}
library(caret)

# Create a confusion matrix
conf_matrix <- confusionMatrix(factor(test_predictions), factor(test_data$DEATH_EVENT))

# Display the confusion matrix and accuracy
conf_matrix
print(paste("Accuracy:", conf_matrix$overall["Accuracy"]))
```
#Here we obtained an accuracy of 0.85 which is good for predicting survival of patients.

**Drawing ROC curve**
```{r}
library(pROC)

# Create ROC curve
roc_curve <- roc(test_data$DEATH_EVENT, pred_prob)

# Plot ROC curve
plot(roc_curve, main = "ROC Curve", col = "blue", lwd = 2)

# Add a legend
legend("bottomright", legend = paste("AUC =", round(auc(roc_curve), 4)), col = "blue", lwd = 2)
```
**Again AUC score is 0.8843 which represent good measure of the discriminative ability of a classification model.** 

